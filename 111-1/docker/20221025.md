# 第8周

# ux/ui

## gitlab ssh-key

user4-1

  cd ~
  .ssh
  ssh-keygen #如果沒有id_rsa.pub要新增金鑰
  cd .ssh
  ls
  cat id_rsa.pub

  ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDpWj+JNJYbPOWVD0RZhYjWeh96MyBVlocxxSYQIYKd3n5P9BVd3ddTqdfRz+d+JQ0P7S0XCRmHW5hhpMoJkS+Afm+z89frXtbPFeIFO3SoKqmQEkrE42qrB1aIp9DTTDCETKLDtVyuY1wMG8ZljfbPqAElVT9ToGOwH4Z+2aZb/8LecuF7qPdiy5Sp26/siOgnhdPg80UA3ph3B6WElW3WfzB1YP4s4uyJOsvpws3vfMxqFbDIXj4x8XiHcN0ew1egGI7EztozGMPaiib8nmgTgEnGNhYBgfpYUb/nGj5O17YT2fVswmShlcWbFcAdxkLffL+Q2FIAepf1Z44e7yTJ root@user4-2

user4-2同上  
並且將此金鑰貼在gitlab中

## 初始化設定
tum install git -y
git config

以及上傳成功

cat id_rsa.pub
yum install git -y
cd ~
ls
cd test_iris
git init
git config --global user.name "ChenChun"
git config --global user.email "leana891121@gmail.com"
git init
git remote add origin https://gitlab.com/Chen-Chun/myiris.git
git add .
git commit -m "Initial commit"
git push -u origin master


## gitlab runner

user4-2


  yum install git -y
  sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  sudo chmod +x /usr/local/bin/gitlab-runner
  sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
  usermod -aG docker gitlab-runner
  gitlab-runner register                      
                                                    
  Enter the GitLab instance URL (for example, https://gitlab.com/):
  https://gitlab.com/
  Enter the registration token:
  GR1348941z2YYxXYecN8-d1u7uPBj
  Enter a description for the runner:
  [user4-2]: user4-2
  Enter tags for the runner (comma-separated):
  user4-2
  Enter optional maintenance note for the runner:

  Registering runner... succeeded                     runner=GR1348941z2YYxXYe
  Enter an executor: custom, virtualbox, instance, ssh, docker+machine, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, shell:
  shell
  Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!
  
  Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml" 

  gitlab-runner run --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --syslog --user gitlab-runner


## 基礎鏡像下載
腳本通知gitlab runner user2




## user4-3
[user@user4-3 ~]$ su
Password: 
[root@user4-3 user]# docker ps -a
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS                     PORTS                    NAMES
ff28fd460591        iris                  "/bin/sh -c 'python …"   33 seconds ago      Up 31 seconds              0.0.0.0:5001->5001/tcp   iris
a4a6e82335fe        adguard/adguardhome   "/opt/adguardhome/Ad…"   2 weeks ago         Exited (128) 13 days ago                            adguardhome
[root@user4-3 user]# ifconfig
docker0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        inet6 fe80::42:c1ff:fe76:a13e  prefixlen 64  scopeid 0x20<link>
        ether 02:42:c1:76:a1:3e  txqueuelen 0  (Ethernet)
        RX packets 24  bytes 2190 (2.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 40  bytes 43802 (42.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.111.152  netmask 255.255.255.0  broadcast 192.168.111.255
        inet6 fe80::321d:7f61:313:e6ff  prefixlen 64  scopeid 0x20<link>
        inet6 fe80::40e:91cb:2333:3677  prefixlen 64  scopeid 0x20<link>
        inet6 fe80::f7d6:6710:448c:a56d  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:52:ae:31  txqueuelen 1000  (Ethernet)
        RX packets 352905  bytes 529447781 (504.9 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 45200  bytes 2789271 (2.6 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 32  bytes 2592 (2.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 32  bytes 2592 (2.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

veth96ce25b: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::e40a:a1ff:fe40:8e27  prefixlen 64  scopeid 0x20<link>
        ether e6:0a:a1:40:8e:27  txqueuelen 0  (Ethernet)
        RX packets 1  bytes 42 (42.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 1019 (1019.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:23:bb:2c  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root@user4-3 user]# ps
   PID TTY          TIME CMD
  3982 pts/1    00:00:00 su
  3985 pts/1    00:00:00 bash
  4056 pts/1    00:00:00 ps
[root@user4-3 user]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
ff28fd460591        iris                "/bin/sh -c 'python …"   2 minutes ago       Up 2 minutes        0.0.0.0:5001->5001/tcp   iris
[root@user4-3 user]# ls
Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos
[root@user4-3 user]# cd ~
[root@user4-3 ~]# ls
anaconda-ks.cfg  original-ks.cfg
[root@user4-3 ~]# cd /home
[root@user4-3 home]# ls
gitlab-runner  user
[root@user4-3 home]# cd gitlab-runner/
[root@user4-3 gitlab-runner]# ls
builds
[root@user4-3 gitlab-runner]# cd builds/
[root@user4-3 builds]# ls
d93Dp8Be
[root@user4-3 builds]# cd d93Dp8Be/
[root@user4-3 d93Dp8Be]# ls
0
[root@user4-3 d93Dp8Be]# cd 
[root@user4-3 ~]# scp root@192.168.111.150:/root/test_iris/client.py .
The authenticity of host '192.168.111.150 (192.168.111.150)' can't be established.
ECDSA key fingerprint is SHA256:nbL3V6FuePEYGYtSTTqxrSSvyiFD2U9DtSpsEdzV5D8.
ECDSA key fingerprint is MD5:16:78:a3:61:50:33:b4:89:95:1a:3d:d1:e1:d5:f1:f8.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.111.150' (ECDSA) to the list of known hosts.
root@192.168.111.150's password: 
client.py                                            100%  297   419.5KB/s   00:00    
[root@user4-3 ~]# vim client.py
[root@user4-3 ~]# python client.py
Traceback (most recent call last):
  File "client.py", line 12, in <module>
    r = requests.post(url,json={'feature': feature})
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 108, in post
    return request('post', url, data=data, json=json, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 50, in request
    response = session.request(method=method, url=url, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 486, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 598, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/adapters.py", line 415, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', error(111, 'Connection refused'))
[root@user4-3 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
1d2219a27272        iris                "/bin/sh -c 'python …"   40 seconds ago      Up 39 seconds       0.0.0.0:5002->5002/tcp   iris

---
[user@user4-3 ~]$ su
Password: 
[root@user4-3 user]# cd ~
[root@user4-3 ~]# cd .ssh
[root@user4-3 .ssh]# ls
authorized_keys  known_hosts
[root@user4-3 .ssh]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:cohXld3rev+uwnnVlF2ENfM4xa42B5y02Y3FPUA/1j8 root@user4-3
The key's randomart image is:
+---[RSA 2048]----+
|          .o.+.O=|
|         .. . =+@|
|        .    oo&O|
|     . o      XoO|
|    . + S    . Eo|
|     . o      = =|
|           . + + |
|            = o  |
|             +.+=|
+----[SHA256]-----+
[root@user4-3 .ssh]# 
[root@user4-3 .ssh]# ls
authorized_keys  id_rsa  id_rsa.pub  known_hosts
[root@user4-3 .ssh]# cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1QAzXViBwyDkBfvKxL/UfA8yNdysx/mihIAPpjeFTMtqyq1YIfQKY+SFMryxpuA1kbmMQqHHj4pr4dOVBnm0INn2r5jy5Xm68b6Y4nOXVzJKEb6L9cE+9Umltc8Hxn1oSL58O+vUczvCWuyxhjvNjnD50HNunFjdVf6/Z9ivDEBCQsji/IP/h7YZUggGLqbqOc/jkDgb/vmMj/eq67nshMhH3KDg/S7mRu5dr7C60jKTASwt/ZK8vusoXYb43ypen7SADxfIa8HswH/xc6dj+WdweQ5l2bZSu36GpoPrkn7EvCWEuBEmmMzMG/TkwgGYuy9P1P13bDBiJOG5wlY4F root@user4-3
[root@user4-3 .ssh]# ^C
[root@user4-3 .ssh]# yum install git -y
Loaded plugins: fastestmirror, langpacks
Existing lock /var/run/yum.pid: another copy is running as pid 2732.
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 00:54 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 00:56 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 00:58 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 01:00 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 01:02 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 01:04 ago
    State  : Sleeping, pid: 2732
^C

Exiting on user cancel.
[root@user4-3 .ssh]# kill 2732
[root@user4-3 .ssh]# cd ..
[root@user4-3 ~]# yum install git -y
Loaded plugins: fastestmirror, langpacks
Existing lock /var/run/yum.pid: another copy is running as pid 2732.
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 01:23 ago
    State  : Sleeping, pid: 2732
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory : 137 M RSS (567 MB VSZ)
    Started: Mon Oct 24 20:22:51 2022 - 01:25 ago
    State  : Sleeping, pid: 2732
^C

Exiting on user cancel.
[root@user4-3 ~]# kill2732
bash: kill2732: command not found...
[root@user4-3 ~]# kill 2732
bash: kill: (2732) - No such process
[root@user4-3 ~]# yum install git
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror01.idc.hinet.net
 * extras: mirror01.idc.hinet.net
 * updates: mirror01.idc.hinet.net
Resolving Dependencies
--> Running transaction check
---> Package git.x86_64 0:1.8.3.1-23.el7_8 will be installed
--> Processing Dependency: perl-Git = 1.8.3.1-23.el7_8 for package: git-1.8.3.1-23.el7_8.x86_64
--> Processing Dependency: perl(Term::ReadKey) for package: git-1.8.3.1-23.el7_8.x86_64
--> Processing Dependency: perl(Git) for package: git-1.8.3.1-23.el7_8.x86_64
--> Processing Dependency: perl(Error) for package: git-1.8.3.1-23.el7_8.x86_64
--> Running transaction check
---> Package perl-Error.noarch 1:0.17020-2.el7 will be installed
---> Package perl-Git.noarch 0:1.8.3.1-23.el7_8 will be installed
---> Package perl-TermReadKey.x86_64 0:2.30-20.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=======================================================================================
 Package                  Arch           Version                    Repository    Size
=======================================================================================
Installing:
 git                      x86_64         1.8.3.1-23.el7_8           base         4.4 M
Installing for dependencies:
 perl-Error               noarch         1:0.17020-2.el7            base          32 k
 perl-Git                 noarch         1.8.3.1-23.el7_8           base          56 k
 perl-TermReadKey         x86_64         2.30-20.el7                base          31 k

Transaction Summary
=======================================================================================
Install  1 Package (+3 Dependent packages)

Total download size: 4.5 M
Installed size: 22 M
Is this ok [y/d/N]: y
Downloading packages:
(1/4): perl-Error-0.17020-2.el7.noarch.rpm                      |  32 kB  00:00:00     
(2/4): perl-Git-1.8.3.1-23.el7_8.noarch.rpm                     |  56 kB  00:00:00     
(3/4): perl-TermReadKey-2.30-20.el7.x86_64.rpm                  |  31 kB  00:00:00     
(4/4): git-1.8.3.1-23.el7_8.x86_64.rpm                          | 4.4 MB  00:00:02     
---------------------------------------------------------------------------------------
Total                                                     1.7 MB/s | 4.5 MB  00:02     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : 1:perl-Error-0.17020-2.el7.noarch                                   1/4 
  Installing : perl-TermReadKey-2.30-20.el7.x86_64                                 2/4 
  Installing : perl-Git-1.8.3.1-23.el7_8.noarch                                    3/4 
  Installing : git-1.8.3.1-23.el7_8.x86_64                                         4/4 
  Verifying  : git-1.8.3.1-23.el7_8.x86_64                                         1/4 
  Verifying  : 1:perl-Error-0.17020-2.el7.noarch                                   2/4 
  Verifying  : perl-Git-1.8.3.1-23.el7_8.noarch                                    3/4 
  Verifying  : perl-TermReadKey-2.30-20.el7.x86_64                                 4/4 

Installed:
  git.x86_64 0:1.8.3.1-23.el7_8                                                        

Dependency Installed:
  perl-Error.noarch 1:0.17020-2.el7           perl-Git.noarch 0:1.8.3.1-23.el7_8      
  perl-TermReadKey.x86_64 0:2.30-20.el7      

Complete!
[root@user4-3 ~]# sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 50.2M  100 50.2M    0     0  1689k      0  0:00:30  0:00:30 --:--:--  875k
[root@user4-3 ~]# sudo chmod +x /usr/local/bin/gitlab-runner
[root@user4-3 ~]# sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
[root@user4-3 ~]# usermod -aG docker gitlab-runner
[root@user4-3 ~]# gitlab-runner register
Runtime platform                                    arch=amd64 os=linux pid=2865 revision=0d4137b8 version=15.5.0
Running in system-mode.                            
                                                   
Enter the GitLab instance URL (for example, https://gitlab.com/):
https://gitlab.com/
Enter the registration token:
GR1348941MNsivd9vzVZz1dLVdPFu
Enter a description for the runner:
[user4-3]: user4-3
Enter tags for the runner (comma-separated):
user4-3
Enter optional maintenance note for the runner:

Registering runner... succeeded                     runner=GR1348941MNsivd9v
Enter an executor: docker+machine, instance, kubernetes, shell, ssh, docker-ssh, parallels, virtualbox, docker-ssh+machine, custom, docker:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!
 
Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml" 
[root@user4-3 ~]# systemctl status firewalld
● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2022-10-24 20:19:41 PDT; 7min ago
     Docs: man:firewalld(1)
 Main PID: 683 (firewalld)
    Tasks: 2
   CGroup: /system.slice/firewalld.service
           └─683 /usr/bin/python2 -Es /usr/sbin/firewalld --nofork --nopid

Oct 24 20:19:38 user4-3 systemd[1]: Starting firewalld - dynamic firewall daemon...
Oct 24 20:19:41 user4-3 systemd[1]: Started firewalld - dynamic firewall daemon.
Oct 24 20:19:41 user4-3 firewalld[683]: WARNING: AllowZoneDrifting is enabled. Thi...w.
Hint: Some lines were ellipsized, use -l to show in full.
[root@user4-3 ~]# systemctl stop firewalld
[root@user4-3 ~]# systemctl disable firewalld
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
[root@user4-3 ~]# getenforce
Disabled
[root@user4-3 ~]# systemctl start docker
[root@user4-3 ~]# systemctl enable docker
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
[root@user4-3 ~]# gitlab-runner run --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --syslog --user gitlab-runner
Runtime platform                                    arch=amd64 os=linux pid=3465 revision=0d4137b8 version=15.5.0
Starting multi-runner from /etc/gitlab-runner/config.toml...  builds=0
Running in system-mode.                            
                                                   
Configuration loaded                                builds=0
listen_address not defined, metrics & debug endpoints disabled  builds=0
[session_server].listen_address not defined, session endpoints disabled  builds=0
Checking for jobs... received                       job=3221244410 repo_url=https://gitlab.com/Chen-Chun/myiris.git runner=d93Dp8Be
Job succeeded                                       duration_s=132.880923114 job=3221244410 project=40492353 runner=d93Dp8Be
Checking for jobs... received                       job=3221276734 repo_url=https://gitlab.com/Chen-Chun/myiris.git runner=d93Dp8Be
Job succeeded                                       duration_s=4.72005116 job=3221276734 project=40492353 runner=d93Dp8Be


user4-1

[user@user4-1 ~]$ su
Password: 
[root@user4-1 user]# cd ~
[root@user4-1 ~]# cd test_iris/
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# vim client.py
[root@user4-1 test_iris]# python client.py
virginica
[root@user4-1 test_iris]# vim server,py
[root@user4-1 test_iris]# vim server.py
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git add server.py
[root@user4-1 test_iris]# git commit -m "add"
[master 1c35723] add
 2 files changed, 3 insertions(+), 3 deletions(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
To https://gitlab.com/Chen-Chun/myiris.git
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://gitlab.com/Chen-Chun/myiris.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first merge the remote changes (e.g.,
hint: 'git pull') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
To https://gitlab.com/Chen-Chun/myiris.git
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://gitlab.com/Chen-Chun/myiris.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first merge the remote changes (e.g.,
hint: 'git pull') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
[root@user4-1 test_iris]# git pull -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
remote: Enumerating objects: 5, done.
remote: Counting objects: 100% (5/5), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 3 (delta 2), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (3/3), done.
From https://gitlab.com/Chen-Chun/myiris
 * branch            master     -> FETCH_HEAD
Merge made by the 'recursive' strategy.
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git add server.py
[root@user4-1 test_iris]# git commit -m "add"
# On branch master
# Your branch is ahead of 'origin/master' by 3 commits.
#   (use "git push" to publish your local commits)
#
nothing to commit, working directory clean
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
To https://gitlab.com/Chen-Chun/myiris.git
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://gitlab.com/Chen-Chun/myiris.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first merge the remote changes (e.g.,
hint: 'git pull') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# vim server.py
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git add server.py
[root@user4-1 test_iris]# git commit -m "add"
[master 4bdf69a] add
 2 files changed, 2 insertions(+), 2 deletions(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun        
Password for 'https://Chen-Chun@gitlab.com': 
To https://gitlab.com/Chen-Chun/myiris.git
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://gitlab.com/Chen-Chun/myiris.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first merge the remote changes (e.g.,
hint: 'git pull') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
[root@user4-1 test_iris]# git pull 
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 7 (delta 2), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (7/7), done.
From https://gitlab.com/Chen-Chun/myiris
   bc05731..e4afeea  master     -> origin/master
 * [new branch]      main       -> origin/main
CONFLICT (modify/delete): server.py deleted in e4afeea83036a908e355a01324acaaa81f5cb8ce and modified in HEAD. Version HEAD of server.py left in tree.
CONFLICT (modify/delete): .gitlab-ci.yml deleted in e4afeea83036a908e355a01324acaaa81f5cb8ce and modified in HEAD. Version HEAD of .gitlab-ci.yml left in tree.
Automatic merge failed; fix conflicts and then commit the result.
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# cat server.py
# coding: utf-8
import pickle

from flask import Flask, request, jsonify

app = Flask(__name__)

# Load the model
model = pickle.load(open('model.pkl', 'rb'))
labels = {
  0: "versicolor",   
  1: "setosa",
  2: "virginica"
}

@app.route('/api', methods=['POST'])
def predict():
    # Get the data from the POST request.
    data = request.get_json(force = True)
    predict = model.predict(data['feature'])
    return jsonify(predict[0].tolist())

if __name__ == '__main__':
    app.run(debug = True, host = '0.0.0.0', port=5002)

[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
To https://gitlab.com/Chen-Chun/myiris.git
 ! [rejected]        master -> master (non-fast-forward)
error: failed to push some refs to 'https://gitlab.com/Chen-Chun/myiris.git'
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Merge the remote changes (e.g. 'git pull')
hint: before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
[root@user4-1 test_iris]# git push -f origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 14, done.
Compressing objects: 100% (9/9), done.
Writing objects: 100% (9/9), 812 bytes | 0 bytes/s, done.
Total 9 (delta 7), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
 + e4afeea...4bdf69a master -> master (forced update)
[root@user4-1 test_iris]# vim client.py
[root@user4-1 test_iris]# python client.py
virginica
[root@user4-1 test_iris]# 


[root@user4-1 test_iris]# ^C
[root@user4-1 test_iris]# sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 50.2M  100 50.2M    0     0  1675k      0  0:00:30  0:00:30 --:--:--  799k
[root@user4-1 test_iris]# sudo chmod +x /usr/local/bin/gitlab-runner
[root@user4-1 test_iris]# sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
[root@user4-1 test_iris]# usermod -aG docker gitlab-runner
[root@user4-1 test_iris]# gitlab-runner register
Runtime platform                                    arch=amd64 os=linux pid=3700 revision=0d4137b8 version=15.5.0
Running in system-mode.                            
                                                   
Enter the GitLab instance URL (for example, https://gitlab.com/):
https://gitlab.com/
Enter the registration token:
GR1348941dYFcTSx1TV2_2z2yHWxu
Enter a description for the runner:
[user4-1]: user4-1
Enter tags for the runner (comma-separated):
user4-1
Enter optional maintenance note for the runner:

Registering runner... succeeded                     runner=GR1348941dYFcTSx1
Enter an executor: docker, docker-ssh, parallels, docker+machine, instance, kubernetes, custom, shell, ssh, virtualbox, docker-ssh+machine:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!
 
Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml" 
[root@user4-1 test_iris]# sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 50.2M  100 50.2M    0     0  2262k      0  0:00:22  0:00:22 --:--:-- 2720k
[root@user4-1 test_iris]# sudo chmod +x /usr/local/bin/gitlab-runner
[root@user4-1 test_iris]# sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
useradd: user 'gitlab-runner' already exists
[root@user4-1 test_iris]# usermod -aG docker gitlab-runner
[root@user4-1 test_iris]# gitlab-runner register
Runtime platform                                    arch=amd64 os=linux pid=3809 revision=0d4137b8 version=15.5.0
Running in system-mode.                            
                                                   
Enter the GitLab instance URL (for example, https://gitlab.com/):
https://gitlab.com/
Enter the registration token:
GR1348941z2YYxXYecN8-d1u7uPBj
Enter a description for the runner:
[user4-1]: user4-1
Enter tags for the runner (comma-separated):
user4-1
Enter optional maintenance note for the runner:

Registering runner... succeeded                     runner=GR1348941z2YYxXYe
Enter an executor: docker, docker-ssh, parallels, instance, custom, shell, ssh, virtualbox, docker+machine, docker-ssh+machine, kubernetes:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!
 
Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml" 
[root@user4-1 test_iris]# gitlab-runner run --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --syslog --user gitlab-runner
Runtime platform                                    arch=amd64 os=linux pid=3839 revision=0d4137b8 version=15.5.0
Starting multi-runner from /etc/gitlab-runner/config.toml...  builds=0
Running in system-mode.                            
                                                   
Configuration loaded                                builds=0
listen_address not defined, metrics & debug endpoints disabled  builds=0
[session_server].listen_address not defined, session endpoints disabled  builds=0
ERROR: Checking for jobs... forbidden               runner=WcbkCiG2
ERROR: Checking for jobs... forbidden               runner=WcbkCiG2
ERROR: Checking for jobs... forbidden               runner=WcbkCiG2
ERROR: Runner https://gitlab.com/WcbkCiG2npkuu_y4afWf is not healthy and will be disabled! 

^CWARNING: [runWait] received stop signal             builds=0 stop-signal=interrupt
WARNING: Graceful shutdown not finished properly    builds=0 error=received stop signal: interrupt
WARNING: Starting forceful shutdown                 StopSignal=interrupt builds=0
WARNING: Checking for jobs... failed                runner=XGFTu7LG status=couldn't execute POST against https://gitlab.com/api/v4/jobs/request: Post "https://gitlab.com/api/v4/jobs/request": context canceled
All workers stopped. Can exit now                   builds=0
[root@user4-1 test_iris]# vim .gitlab-ci.yml
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# cat Dockerfile 
FROM nitincypher/docker-ubuntu-python-pip

COPY ./requirements.txt /app/requirements.txt

WORKDIR /app

RUN pip install -r requirements.txt

COPY server.py /app

COPY train_model.py /app

CMD python /app/train_model.py && python /app/server.py
[root@user4-1 test_iris]# ll -a
total 1900
drwxr-xr-x   3 root root     173 Oct 24 19:31 .
dr-xr-x---. 12 root root    4096 Oct 24 19:31 ..
-rw-r--r--   1 root root     297 Oct 17 20:47 client.py
-rw-r--r--   1 root root     244 Oct 17 20:32 Dockerfile
-rw-r--r--   1 root root 1908226 Feb 22  2021 get-pip.py
drwxr-xr-x   8 root root     166 Oct 24 18:52 .git
-rw-r--r--   1 root root     240 Oct 24 19:31 .gitlab-ci.yml
-rw-r--r--   1 root root    6243 Oct 17 20:13 model.pkl
-rw-r--r--   1 root root      14 Oct 17 20:36 requirements.txt
-rw-r--r--   1 root root     521 Oct 17 20:15 server.py
-rw-r--r--   1 root root     670 Oct 17 20:35 train_model.py
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add . gitlab-ci.yml"
[master 6d1133b] add . gitlab-ci.yml
 1 file changed, 11 insertions(+)
 create mode 100644 .gitlab-ci.yml
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 4, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 428 bytes | 0 bytes/s, done.
Total 3 (delta 1), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   5c94b8e..6d1133b  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# git config --global user.name "Chen-Chun"
[root@user4-1 test_iris]# git config --global user.email "leana891121@gmail.com"
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
# On branch master
nothing to commit, working directory clean
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Branch master set up to track remote branch master from origin.
Everything up-to-date
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
[master 295a3e1] add gitlab-ci.yml
 1 file changed, 1 insertion(+), 1 deletion(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 295 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   6d1133b..295a3e1  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# ll -a
total 1900
drwxr-xr-x   3 root root     173 Oct 24 19:38 .
dr-xr-x---. 12 root root    4096 Oct 24 19:38 ..
-rw-r--r--   1 root root     297 Oct 17 20:47 client.py
-rw-r--r--   1 root root     244 Oct 17 20:32 Dockerfile
-rw-r--r--   1 root root 1908226 Feb 22  2021 get-pip.py
drwxr-xr-x   8 root root     166 Oct 24 19:38 .git
-rw-r--r--   1 root root     240 Oct 24 19:38 .gitlab-ci.yml
-rw-r--r--   1 root root    6243 Oct 17 20:13 model.pkl
-rw-r--r--   1 root root      14 Oct 17 20:36 requirements.txt
-rw-r--r--   1 root root     521 Oct 17 20:15 server.py
-rw-r--r--   1 root root     670 Oct 17 20:35 train_model.py
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
[master 4257a57] add gitlab-ci.yml
 1 file changed, 1 insertion(+), 1 deletion(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 295 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   295a3e1..4257a57  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# cat requirements.txt 
sklearn
flask
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
# On branch master
nothing to commit, working directory clean
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Branch master set up to track remote branch master from origin.
Everything up-to-date
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
# On branch master
nothing to commit, working directory clean
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Branch master set up to track remote branch master from origin.
Everything up-to-date
[root@user4-1 test_iris]# vim .gitlab-ci.yml
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen0Chun
Password for 'https://Chen0Chun@gitlab.com': 
\
fatal: Authentication failed for 'https://gitlab.com/Chen-Chun/myiris.git/'
[root@user4-1 test_iris]# \
> ^C
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Branch master set up to track remote branch master from origin.
Everything up-to-date
[root@user4-1 test_iris]# cd ~
[root@user4-1 ~]# cd .ssh
[root@user4-1 .ssh]# ls
id_rsa  id_rsa.pub  known_hosts
[root@user4-1 .ssh]# cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/qD1nhhbWiyTJ1gXVYYhCxzQHEUlLMH8Ro6PPrfQnsOpVj/de6TsA1jpKjotV2qZ2XRtp3rSI1lcTeIWB3eD7ZtjP8YgzjhWHgVOgJ2Ja5wkfBBiRyJyxFr7hrkG8E5WCdY4too12pJeCYPx5d8uRJM38rtvboBx3rshrv383P4ZI7ok6b2hdTbGNhWE8NIezMlwV6vVWKtKiPUq7guCMyU2caUj+69Q4iIa8AlrSo6NvowwkQ5FhUrNqhmi5MSl7KjwwbzB4KnsudZbtgjU+LacRWkOwsOm3VKiqGOqpCyHEz85Kg8ZFwClwR0KbCqOJa5oF0yibBaDhfbnlajlr root@user4-1
[root@user4-1 .ssh]# ^C
[root@user4-1 .ssh]# cd ~
[root@user4-1 ~]# ls
anaconda-ks.cfg  mydbdata  myphp  original-ks.cfg  test_iris  test_phpmysql
[root@user4-1 ~]# cd test_iris/
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# vim .gitlab-ci.yml
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -a "add "
fatal: Paths with -a does not make sense.
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
[master 270b9ed] add gitlab-ci.yml
 1 file changed, 1 insertion(+), 1 deletion(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 290 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   4257a57..270b9ed  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# cd ~
[root@user4-1 ~]# cd .ssh
[root@user4-1 .ssh]# rm -rf *
[root@user4-1 .ssh]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:wEJsyOsS2ZX78Crxa5Ud1KEpnzbtWHZCKfY/eCBsKdQ root@user4-1
The key's randomart image is:
+---[RSA 2048]----+
| . o..   ...     |
|  o.=. ..o..     |
| o +..=.E o      |
|o o oo *.B       |
| o   +.oS.B .    |
|. o   =+.B *     |
| . o o  . o +    |
|  . +      . .   |
|   o..           |
+----[SHA256]-----+
[root@user4-1 .ssh]# ls
id_rsa  id_rsa.pub
[root@user4-1 .ssh]# cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9wUSdP8NCo0P1XqLVH93wElqi6tzlyu64dAai4Vqs5pN4AyU2soMzHUaIudfw3efhtNXFNNz6R7aQby2q1a1xBJkBVM4XGM8L0cB+xROj8QJm4f2HXBauIDAOn7bNWnm7Q0vmfcNwrmLEYTDAOqzQEPF4SAdNV6wHkYHsrAb/PNx3Vvg9fRO7ip3T+fhI2wSNpy25fgb2XTArzSIDXtItaQL+FG08s/nZfDguBDw7Iwi2Lk0swuuW6GO9VNKUrY4sKz9j5+W8Z5q6FVNTEbLvaqIqAqFc7cCdu2hneQayrDaJ2Uip2btK/c9vd7GlTHorWDgDKtGry5OR8NgxmEyj root@user4-1
[root@user4-1 .ssh]# ^C
[root@user4-1 .ssh]# cd ~
[root@user4-1 ~]# cd test_iris/
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# cat .gitlab-ci.yml 
tages:
  - deploy

docker-deploy:
  stage: deploy
  script:
    - docker build -t iris .
    - if [ $(docker ps -aq --filter name=iris) ]; then docker rm -f iris; fi
    - docker run -d -p 5002:5001 --name iris iris
  tags:
    - user4-2
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
[master ac385e9] add gitlab-ci.yml
 1 file changed, 1 insertion(+), 1 deletion(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 299 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   270b9ed..ac385e9  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# git add .gitlab-ci.yml
[root@user4-1 test_iris]# git commit -m "add gitlab-ci.yml"
[master bc05731] add gitlab-ci.yml
 1 file changed, 1 insertion(+), 1 deletion(-)
[root@user4-1 test_iris]# git push -u origin master
Username for 'https://gitlab.com': Chen-Chun
Password for 'https://Chen-Chun@gitlab.com': 
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 292 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: 
remote: To create a merge request for master, visit:
remote:   https://gitlab.com/Chen-Chun/myiris/-/merge_requests/new?merge_request%5Bsource_branch%5D=master
remote: 
To https://gitlab.com/Chen-Chun/myiris.git
   ac385e9..bc05731  master -> master
Branch master set up to track remote branch master from origin.
[root@user4-1 test_iris]# vim .gitlab-ci.yml 
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.111.150  netmask 255.255.255.0  broadcast 192.168.111.255
        inet6 fe80::f7d6:6710:448c:a56d  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:ed:69:9d  txqueuelen 1000  (Ethernet)
        RX packets 80452  bytes 114881321 (109.5 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 8497  bytes 2970552 (2.8 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 64  bytes 5184 (5.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 64  bytes 5184 (5.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:23:bb:2c  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1  bytes 227 (227.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root@user4-1 test_iris]# vim client.py
[root@user4-1 test_iris]# python client.py 
Traceback (most recent call last):
  File "client.py", line 12, in <module>
    r = requests.post(url,json={'feature': feature})
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 108, in post
    return request('post', url, data=data, json=json, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 50, in request
    response = session.request(method=method, url=url, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 486, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 598, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/adapters.py", line 415, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', error(111, 'Connection refused'))
[root@user4-1 test_iris]# vim client.py
[root@user4-1 test_iris]# ping 192.168.111.152
PING 192.168.111.152 (192.168.111.152) 56(84) bytes of data.
64 bytes from 192.168.111.152: icmp_seq=1 ttl=64 time=1.34 ms
64 bytes from 192.168.111.152: icmp_seq=2 ttl=64 time=0.734 ms
^C
--- 192.168.111.152 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1004ms
rtt min/avg/max/mdev = 0.734/1.037/1.340/0.303 ms
[root@user4-1 test_iris]# python client.py 
Traceback (most recent call last):
  File "client.py", line 12, in <module>
    r = requests.post(url,json={'feature': feature})
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 108, in post
    return request('post', url, data=data, json=json, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/api.py", line 50, in request
    response = session.request(method=method, url=url, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 486, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python2.7/site-packages/requests/sessions.py", line 598, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python2.7/site-packages/requests/adapters.py", line 415, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', error(111, 'Connection refused'))
[root@user4-1 test_iris]# ls
client.py   get-pip.py  requirements.txt  train_model.py
Dockerfile  model.pkl   server.py
[root@user4-1 test_iris]# python server.py
 * Serving Flask app "server" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 853-283-143
192.168.111.150 - - [24/Oct/2022 20:39:20] "POST /api HTTP/1.1" 200 -
 * Detected change in '/root/test_iris/server.py', reloading
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 853-283-143
 * Detected change in '/root/test_iris/server.py', reloading
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 853-283-143









