# 第六周

## 多容器互相溝通

    su
    systemctl start docker
    docker ps
    docker ps -a
    docker pull mysql
    docker pull radys/php-apache:7.4

需要先確認網路裏面有上週創建的mybr

    docker network ls
    docker create -d mybr
    docker run -d --network mybr --name hello-mysql -e MYSQL_ROOT_PASSWORD=123456 -p 3306 mysql

並開始執行mysql

    docker exec -it hello-mysql bash
    mysql -u root -p
    密碼:123456
    create database testdb;
    use testdb;
    create table addrbook(name varchar(50) not null, phone varchar(10));
    insert into addrbook(name, phone) values ("tom", "123456");
    insert into addrbook(name, phone) values ("mary", "654321");
    select * from addrbook;

<img src=".\pic\photo_2022-10-11_10-32-16.jpg">

將上一個mysql刪除並創建資料夾  
再重新開mysql並指定路徑 還有上面步驟再做一次

    docker rm -f (上一個mysql)
    mkdir mydbdata
    cd mydbdata
    docker run -d --network mybr --name hello-mysql -e MYSQL_ROOT_PASSWORD=123456 -v /root/mydbdata:/var/lib/mysql mysql

開啟php

    mkdir myphp
    cd myphp
    docker run -d -p 80:80 --network mybr -v /root/myphp:/var/www/html --name hello-php radys/php-apache:7.4
    vim test.php

    <?php
    phpinfo();
    ?>

在網頁端確定php連線成功
192.168.111.150/test.php

<img src=".\pic\photo_2022-10-11_10-32-08.jpg">

    vim index.php

    <?php
    $servername="hello-mysql";
    $username="root";
    $password="123456";
    $dbname="testdb";

    $conn = new mysqli($servername, $username, $password, $dbname);

    if($conn->connect_error){
    die("connection failed:" . $conn->connect_error);
    }

    $sql="select name, phone from addrbook";
    $result = $conn->query($sql);

    if($result->num_rows >0){
    while($row = $result->fetch_assoc()){
        echo "name:" . $row["name"]." phone:".$row["phone"]."<br>";
    }
    } else {
    echo "0 result";
    }

    ?>
    

確認可以將mysql資料用網頁讀取出來
192.168.111.150/index.php

<img src=".\pic\photo_2022-10-11_10-31-49.jpg">


## 第一版 如何用docker-compose的方式將網頁呈現

    ls
    cd ..
    mkdir test_phpmysql
    cd test_phpmysql/
    gedit docker-compose.yml

    version: '2.3'
    services:
    hello-php:
        image: radys/php-apache:7.4
        container_name: hello-php
        depends_on:
        - hello-mysql
        ports:
        - "80:80"
        volumes:
        - /root/myphp:/var/www/html
        networks:
        - mybr
    hello-mysql:
        image: mysql:1.0
        container_name: hello-mysql
        environment:
        MYSQL_ROOT_PASSWORD: 123456 
        volumes:
        - /root/mydbdata:/var/lib/mysql
        ports:
        - "3306"
        networks:
        - mybr
    networks:
    mybr:

    ls
    docker ps
    docker commit c1c mysql:1.0
    docker rm -f c1c
    docker rm -f fb5
    ls
    docker-compose up -d
    docker-compose ps

回到網頁上打192.168.111.150   
就會出現剛剛設置的mysql

想回去剛剛的mysql時再新增資料時

docker ps
docker exec -it (container id) bash
use testdb;
insert into addrbook(name,phone) values("leana","0925252525");
select * from addrbook;

再回到網頁上就會發現資料可以新增  
並且就算關閉也不會消失

<img src=".\pic\photo_2022-10-11_11-22-00.jpg">

## 第二版 如何用docker-compose的方式將網頁呈現

先將第一版中的資料全部刪除

    cd mydbdata/
    ls
    rm -rf *

接著

    ls
    cd test_phpmysql/
    mkdir dump
    cd dump
    gedit dump.sql

    use testdb;  
    create table addrbook(name varchar(50) not null, phone varchar(10));
    insert into addrbook(name, phone) values ("tom", "123456");
    insert into addrbook(name, phone) values ("mary", "654321");

    docker-compose up -d




## 將此機器遷移到user4-2




## 將廣告移除

    systemctl start docker
    docker run --name adguardhome\
        --restart unless-stopped\
        -v /my/own/workdir:/opt/adguardhome/work\
        -v /my/own/confdir:/opt/adguardhome/conf\
        -p 53:53/tcp -p 53:53/udp\
        -p 167:67/udp -p 168:68/udp\
        -p 80:80/tcp -p 443:443/tcp -p 443:443/udp -p 3000:3000/tcp\
        -p 853:853/tcp\
        -p 784:784/udp -p 853:853/udp -p 8853:8853/udp\
        -p 5443:5443/tcp -p 5443:5443/udp\
        -d adguard/adguardhome

把占用53端口刪掉

    netstat -tunlp | grep 53
    kill -9 xxxx
    docker ps

將本機 DNS server加入

    gedit /etc/resolv.conf

    # Generated by NetworkManager
    nameserver 127.0.0.1
    nameserver 8.8.8.8

port3000是adguard的使用介面

在網路介面打上127.0.0.1:3000
便註冊當入廣告守衛

    帳號:user
    密碼:user1234

接著再打開youtube就可以  
單第一個廣告還是會顯示  
而是之後就不會再出現廣告了  

<img src="">

## 補充教學
https://hackmd.io/@OgGHGgaiTS-n40lMrpE3Tg/BJFXcu6zK/%2F1Kx9nRVfQ8ig-1o_MrQsYA

https://hackmd.io/@OgGHGgaiTS-n40lMrpE3Tg/BJFXcu6zK/%2FrsPNYeBGQTmazbgc-miKOg







https://manage.realvnc.com/en/download?state=account-created

https://linuxhint.com/ping-command-ubuntu-22-04/

https://hackmd.io/@OgGHGgaiTS-n40lMrpE3Tg/BJFXcu6zK/%2FgPqjaNDTSEu2D8PqbC9W2A


https://github.com/linjiachi/Linux_note/blob/master/109-1%20Docker/W7-20201027.md#gitlab---cicd-continuous-deliverycontinuous-deployment

https://gitlab.com/Chen-Chun